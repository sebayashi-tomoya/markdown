<svg viewBox="0 0 800 1200" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#333"/>
    </marker>
  </defs>
  
  <text x="400" y="30" font-size="24" font-weight="bold" text-anchor="middle">相関サブクエリのループ処理</text>
  
  <rect x="50" y="60" width="700" height="80" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="5"/>
  <text x="400" y="85" font-size="16" font-weight="bold" text-anchor="middle">外側のクエリ: 8行を順番に処理</text>
  <text x="400" y="110" font-size="13" text-anchor="middle" font-family="monospace">SELECT e.name, e.department, s.salary FROM employees e JOIN salaries s ...</text>
  
  <line x1="400" y1="140" x2="400" y2="170" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <rect x="100" y="170" width="600" height="900" fill="none" stroke="#666" stroke-width="3" stroke-dasharray="10,5" rx="10"/>
  <text x="120" y="195" font-size="14" font-weight="bold" fill="#666">ループ: 各行ごとに以下を実行</text>
  
  <g transform="translate(0, 200)">
    <rect x="130" y="20" width="540" height="80" fill="#fff3e0" stroke="#f57c00" stroke-width="2" rx="5"/>
    <text x="150" y="45" font-size="14" font-weight="bold">1行目: 田中 一郎 | 営業 | 300000</text>
    <text x="150" y="70" font-size="12" fill="#d32f2f">サブクエリ: 営業部の最高給与 = 320000</text>
    <text x="150" y="90" font-size="12" font-weight="bold" fill="#d32f2f">300000 ≠ 320000 → ✗ スキップ</text>
  </g>
  
  <g transform="translate(0, 300)">
    <rect x="130" y="20" width="540" height="80" fill="#e8f5e9" stroke="#388e3c" stroke-width="2" rx="5"/>
    <text x="150" y="45" font-size="14" font-weight="bold">2行目: 田中 一郎 | 営業 | 320000</text>
    <text x="150" y="70" font-size="12" fill="#1976d2">サブクエリ: 営業部の最高給与 = 320000</text>
    <text x="150" y="90" font-size="12" font-weight="bold" fill="#388e3c">320000 = 320000 → ✓ 結果に含める</text>
  </g>
  
  <g transform="translate(0, 400)">
    <rect x="130" y="20" width="540" height="80" fill="#fff3e0" stroke="#f57c00" stroke-width="2" rx="5"/>
    <text x="150" y="45" font-size="14" font-weight="bold">3行目: 佐藤 花子 | 営業 | 310000</text>
    <text x="150" y="70" font-size="12" fill="#d32f2f">サブクエリ: 営業部の最高給与 = 320000</text>
    <text x="150" y="90" font-size="12" font-weight="bold" fill="#d32f2f">310000 ≠ 320000 → ✗ スキップ</text>
  </g>
  
  <g transform="translate(0, 500)">
    <rect x="130" y="20" width="540" height="80" fill="#fff3e0" stroke="#f57c00" stroke-width="2" rx="5"/>
    <text x="150" y="45" font-size="14" font-weight="bold">4行目: 鈴木 太郎 | 開発 | 400000</text>
    <text x="150" y="70" font-size="12" fill="#d32f2f">サブクエリ: 開発部の最高給与 = 420000</text>
    <text x="150" y="90" font-size="12" font-weight="bold" fill="#d32f2f">400000 ≠ 420000 → ✗ スキップ</text>
  </g>
  
  <g transform="translate(0, 600)">
    <rect x="130" y="20" width="540" height="80" fill="#e8f5e9" stroke="#388e3c" stroke-width="2" rx="5"/>
    <text x="150" y="45" font-size="14" font-weight="bold">5行目: 鈴木 太郎 | 開発 | 420000</text>
    <text x="150" y="70" font-size="12" fill="#1976d2">サブクエリ: 開発部の最高給与 = 420000</text>
    <text x="150" y="90" font-size="12" font-weight="bold" fill="#388e3c">420000 = 420000 → ✓ 結果に含める</text>
  </g>
  
  <g transform="translate(0, 700)">
    <rect x="130" y="20" width="540" height="60" fill="#f5f5f5" stroke="#999" stroke-width="1" rx="5"/>
    <text x="400" y="55" font-size="14" text-anchor="middle" fill="#666">6〜8行目: 同様に処理...</text>
  </g>
  
  <line x1="400" y1="1070" x2="400" y2="1100" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <rect x="150" y="1100" width="500" height="80" fill="#c8e6c9" stroke="#2e7d32" stroke-width="3" rx="5"/>
  <text x="400" y="1130" font-size="16" font-weight="bold" text-anchor="middle">最終結果</text>
  <text x="400" y="1155" font-size="13" text-anchor="middle" font-family="monospace">田中 一郎 | 営業 | 320000</text>
  <text x="400" y="1175" font-size="13" text-anchor="middle" font-family="monospace">鈴木 太郎 | 開発 | 420000</text>
</svg>